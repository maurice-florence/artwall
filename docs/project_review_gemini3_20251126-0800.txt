ArtWall Next.js: Comprehensive Review & Optimization Plan

Date: November 26, 2025
Target Framework: Next.js 14+ (App Router), Tailwind CSS, Firebase
Objective: Solve image loading latency, stabilize masonry layout, and synchronize UI with design goals.

1. Critical Performance Audit

The "Slow Image" Bottleneck

Observation: The current implementation likely fetches full-resolution images or relies on the browser to handle resizing. This causes Layout Cumulative Shift (CLS) and slow Largest Contentful Paint (LCP).

Root Causes:

Missing sizes prop: Next.js doesn't know how large the image renders on screen, so it might download a 4000px wide image for a 300px card.

No Low-Quality Image Placeholders (LQIP): The user sees whitespace before the image snaps in.

Client-Side Fetching waterfall: If data fetching happens in a useEffect inside the card, it creates a waterfall.

The Masonry Layout Shift

Observation: standard CSS Grid cannot produce a true masonry layout (interlocking bricks of different heights) without JavaScript or CSS Columns. CSS Columns cause ordering issues (top-to-bottom instead of left-to-right).

2. Architecture Recommendations

A. The "Hybrid" Image Strategy

We need a three-tier image loading strategy to make it feel "instant":

Tier 1 (Instant): A Base64 BlurHash string stored directly in the Firestore document (no network request needed for initial color/shape).

Tier 2 (Fast): A generated thumbnail_url (approx 600px width) optimized for the grid.

Tier 3 (Full): The original resolution loaded only when the Modal is opened.

B. Server-Side Data / Client-Side Grid

Server Component (page.tsx): Fetches the initial batch of data from Firestore. This happens on the server, reducing TTFB (Time to First Byte).

Client Component (ArtworkGrid.tsx): Receives the data and handles the Masonry layout and infinite scroll interactions.

C. State Management

Move away from complex Context API for simple data caching. Use TanStack Query (React Query) if creating a robust app, or simple useInfiniteQuery hooks to manage pagination and caching automatically.

3. Implementation Checklist (VS Code Copilot Optimized)

Use these prompts in your VS Code Copilot Chat to implement the fixes efficiently.

Phase 1: Image Optimization (Priority High)

Context: Open src/components/ArtworkCard.tsx

Copilot Prompt:
"Refactor this component to use the next/image component.

Use the fill prop with object-fit: cover.

Add a sizes prop that specifies: '(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw'.

Implement a placeholder='blur' strategy. If blurDataURL is available in the props, use it. Otherwise, use a standard gray generic blur string.

Ensure the parent div has relative positioning and a defined aspect ratio to prevent layout shift."

Phase 2: Masonry Layout Logic

Context: Open src/components/ArtworkGrid.tsx

Copilot Prompt:
"Create a robust Masonry grid using CSS columns for Tailwind.

Use columns-1 sm:columns-2 lg:columns-3 gap-4.

Ensure the direct children (ArtworkCards) have break-inside-avoid and mb-4 to prevent cards from being sliced across columns.

Add a specialized div wrapper for the card that enforces the aspect ratio before the image loads to prevent jumping."

Phase 3: Infinite Scroll & Pagination

Context: Open src/hooks/useArtworks.ts (or create it)

Copilot Prompt:
"Write a custom React hook useFirestoreInfinite that:

Accepts a Firestore collection reference and a page size (limit).

Maintains an array of artworks and a lastDoc cursor state.

Exposes a loadMore function that fetches the next batch starting after lastDoc.

Includes loading and error states.

Filters out duplicates by ID before updating the state."

Phase 4: The 3D Flip Interaction

Context: Open src/components/ArtworkCard.tsx

Copilot Prompt:
"Update the card styling to implement a CSS-only 3D flip on hover.

Wrap the content in a group container with perspective-1000.

Create an inner container with preserve-3d, transition-all, duration-500, and group-hover:rotate-y-180.

Create a Front face (Image) and Back face (Details) both with backface-hidden, absolute, and inset-0.

Rotate the Back face 180deg by default.

Ensure the Back face has the 'ArtWall' gradient background: bg-gradient-to-br from-purple-600 to-blue-500."

4. Code Snippets for Reference

The Robust Image Component (ArtworkCard.tsx)

import Image from 'next/image';

// Assuming artwork.aspectRatio is stored (e.g., 0.8 for 4:5)
// If not, use a standard class like 'aspect-square' or 'aspect-[4/5]'
const Card = ({ artwork }) => {
  return (
    <div className={`relative mb-4 break-inside-avoid rounded-xl overflow-hidden group perspective-1000 w-full aspect-[${artwork.aspectRatio || '1/1'}]`}>
      <div className="relative w-full h-full transition-all duration-500 transform-style-3d group-hover:rotate-y-180">
        
        {/* FRONT */}
        <div className="absolute inset-0 backface-hidden">
           <Image
             src={artwork.thumbnailUrl || artwork.url} // Prefer thumbnail
             alt={artwork.title}
             fill
             sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
             className="object-cover"
             placeholder="blur"
             blurDataURL={artwork.blurHash || "data:image/png;base64,iVBORw0KGgo..."} 
           />
        </div>

        {/* BACK */}
        <div className="absolute inset-0 h-full w-full bg-gradient-to-br from-purple-600 to-blue-500 rotate-y-180 backface-hidden p-6 flex flex-col justify-center items-center text-white">
          <h3 className="text-xl font-bold">{artwork.title}</h3>
          <p>{artwork.year}</p>
        </div>

      </div>
    </div>
  );
};


Tailwind Config (for Animation)

Ensure your tailwind.config.js has the utilities for 3D transforms if you aren't using a plugin:

// tailwind.config.js
module.exports = {
  theme: {
    extend: {
      backgroundImage: {
        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
      }
    },
  },
  plugins: [
    // Use a plugin or add manual utilities for:
    // .perspective-1000, .transform-style-3d, .backface-hidden, .rotate-y-180
  ],
}


5. Summary

To fix the app:

Do not load 4MB images in the grid. Use Cloud Functions to generate thumbnails on upload, or use an image CDN.

Use next/image sizes. This tells the browser "this image is only 33% of the screen width," so it downloads the small version.

Switch Masonry. Use standard CSS Columns (columns-3) for the fastest, most lightweight masonry layout.